{% macro render_equipment_table(equipments, title, icon, color_class, actions_config, empty_msg="No hay equipos
registrados", now_func=none) %}
<div class="card bg-dark-card border-secondary shadow-sm mb-4">
    <div class="card-header border-secondary d-flex justify-content-between align-items-center">
        <div class="{{ color_class }} fw-bold">
            <i class="fas {{ icon }} me-2"></i> {{ title }}
        </div>
        <span class="badge bg-secondary">{{ equipments|length }}</span>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-dark table-hover mb-0 align-middle">
                <thead>
                    <tr class="text-secondary text-uppercase text-center" style="font-size: 0.8rem;">
                        <th class="ps-4 text-start">FR</th>
                        <th>Cliente</th>
                        <th>Equipo</th>
                        <th>Serie</th>
                        <th>Estado</th>
                        {% if 'encargado_diagnostico' in actions_config.columns %}<th>Encargado</th>{% endif %}
                        <th>Fecha</th>
                        {% if title != 'Historial de Entregados' %}<th>Días</th>{% endif %}
                        <th class="text-end pe-4">Acción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for eq in equipments %}
                    <tr class="text-center">
                        <td class="ps-4 text-start">
                            <span
                                class="badge {% if color_class == 'text-info' %}bg-info{% elif color_class == 'text-warning' %}bg-warning text-dark{% else %}bg-secondary{% endif %}">
                                {{ eq.fr or 'N/A' }}
                            </span>
                        </td>
                        <td>{{ eq.cliente or 'N/A' }}</td>
                        <td class="text-start">
                            <div class="d-flex flex-column">
                                <span class="fw-bold">{{ eq.marca }}</span>
                                <small class="text-muted">{{ eq.modelo }}</small>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-dark border border-info text-info">{{ eq.serie or '-' }}</span>
                        </td>
                        <td><span class="badge bg-secondary">{{ eq.estado }}</span></td>
                        {% if 'encargado_diagnostico' in actions_config.columns %}<td>{{ eq.encargado_diagnostico or
                            'N/A' }}</td>{% endif %}
                        {% set base_date = eq.hora_aprobacion if eq.hora_aprobacion else eq.fecha_ingreso %}
                        <td>{{ base_date.strftime('%d/%m/%Y %I:%M %p') if base_date else 'N/A' }}</td>

                        {% if title != 'Historial de Entregados' %}
                        <td>
                            {% if base_date %}
                            {% set dias = ((now_func or now)() - base_date).days %}
                            <span
                                class="badge {% if dias > 7 %}bg-danger{% elif dias > 5 %}bg-warning{% else %}bg-success{% endif %}">
                                {{ dias }}
                            </span>
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        {% endif %}

                        <td class="text-end pe-4">
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-info" onclick="showInfo(this)" data-id="{{ eq.id }}"
                                    data-fr="{{ eq.fr }}" data-marca="{{ eq.marca }} {{ eq.modelo }}"
                                    data-estado="{{ eq.estado }}" data-encargado="{{ eq.encargado_diagnostico }}"
                                    data-fecha="{{ eq.fecha_ingreso.strftime('%d/%m/%Y %I:%M %p') if eq.fecha_ingreso else '' }}"
                                    data-reporte="{{ eq.reporte_cliente | e }}" data-cliente="{{ eq.cliente | e }}"
                                    data-observaciones="{{ eq.observaciones | e }}" data-serie="{{ eq.serie | e }}"
                                    data-informe="{{ eq.numero_informe | e }}" data-accesorios="{{ eq.accesorios | e }}"
                                    data-condicion="{{ eq.condicion | e }}"
                                    data-inicio-diag="{{ eq.hora_inicio_diagnostico.strftime('%d/%m/%Y %I:%M %p') if eq.fecha_ingreso else '' }}"
                                    data-encargado-diag="{{ eq.encargado_diagnostico or '' }}"
                                    data-obs-diag="{{ eq.observaciones_diagnostico or '' }}"
                                    data-inicio-mant="{{ eq.hora_inicio_mantenimiento.strftime('%d/%m/%Y %I:%M %p') if eq.fecha_ingreso else '' }}"
                                    data-encargado-mant="{{ eq.encargado_mantenimiento or '' }}"
                                    data-obs-mant="{{ eq.observaciones_mantenimiento or '' }}"
                                    data-aprobacion="{{ eq.hora_aprobacion.strftime('%d/%m/%Y %I:%M %p') if eq.fecha_ingreso else '' }}">
                                    <i class="fas fa-eye"></i>
                                </button>
                                {% if 'edit' in actions_config.actions %}
                                <button class="btn btn-outline-primary" onclick="showAdvanceModal({{ eq.id }})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="9" class="text-center text-muted py-4">{{ empty_msg }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endmacro %}