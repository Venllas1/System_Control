{% extends "base.html" %}

{% block title %}Edición Masiva (Excel) - CABELAB{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-white mb-0"><i class="fas fa-file-excel me-2"></i> Vista Excel</h2>
            <p class="text-muted mb-0">Edición rápida en línea (Doble click para editar)</p>
        </div>
        <button class="btn btn-outline-light" id="refreshBtn">
            <i class="fas fa-sync-alt"></i> Recargar
        </button>
    </div>

    <!-- FILTER TOOLBAR -->
    <div class="row g-3 mb-3">
        <div class="col-md-4">
            <div class="input-group">
                <span class="input-group-text bg-dark border-secondary text-secondary">
                    <i class="fas fa-search"></i>
                </span>
                <input type="text" id="filterText" class="form-control bg-dark text-light border-secondary"
                    placeholder="Filtrar por FR, Marca, Modelo...">
            </div>
        </div>
        <div class="col-md-3">
            <select id="filterStatus" class="form-select bg-dark text-light border-secondary">
                <option value="">Todos los Estados</option>
                <option value="Espera de Diagnostico">Espera de Diagnostico</option>
                <option value="en Diagnostico">En Diagnostico</option>
                <option value="Pendiente de aprobacion">Pendiente de Aprobación</option>
                <option value="Aprobado">Aprobado</option>

                <option value="En servicio">En Servicio</option>
                <option value="Entregado">Entregado</option>
                <option value="Entregado - Devolucion">Entregado - Devolución</option>
            </select>
        </div>
        <div class="col-md-2">
            <button class="btn btn-secondary w-100" id="clearFiltersBtn">
                <i class="fas fa-times me-2"></i>Limpiar
            </button>
        </div>
    </div>

    <div class="card bg-dark-card border-secondary shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive" style="max-height: 80vh; overflow-y: auto;">
                <table class="table table-dark table-bordered table-sm mb-0 align-middle" id="excelTable">
                    <thead class="bg-dark text-secondary text-uppercase text-xs sticky-top" style="z-index: 10;">
                        <tr>
                            <!-- 18 REQUESTED COLUMNS -->
                            <th style="min-width: 100px;">FR</th>
                            <th style="min-width: 150px;">Marca</th>
                            <th style="min-width: 150px;">Modelo</th>
                            <th style="min-width: 250px;">Reporte Cliente</th>
                            <th style="min-width: 150px;">Estado</th> <!-- READ ONLY -->
                            <th style="min-width: 120px;">Condición</th>
                            <th style="min-width: 150px;">Encargado</th>
                            <th style="min-width: 120px;">Fecha Ingreso</th>
                            <th style="min-width: 250px;">Observaciones</th>
                            <th style="min-width: 150px;">Cliente</th>
                            <th style="min-width: 120px;">Serie</th>
                            <th style="min-width: 200px;">Accesorios</th>
                            <th style="min-width: 150px;">Encargado Mant.</th>
                            <th style="min-width: 120px;">No. Informe</th>
                            <th style="min-width: 150px;">Inicio Diag.</th>
                            <th style="min-width: 200px;">Obs. Diag.</th>
                            <th style="min-width: 150px;">Inicio Mant.</th>
                            <th style="min-width: 120px;">Hora Aprobación</th>
                            <th style="min-width: 200px;">Obs. Mant.</th>
                        </tr>
                    </thead>
                    <tbody id="excelTableBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Status Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="saveToast" class="toast align-items-center text-white bg-success border-0" role="alert"
            aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-check-circle me-2"></i> Guardado correctamente
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/excel_logic.js') }}"></script>
{% endblock %}